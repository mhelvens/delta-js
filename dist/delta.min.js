!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):"object"==typeof exports?exports.DeltaModel=e():t.DeltaModel=e()}(this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var o,i;o=[n(1)],i=function(t){"use strict";var e=t.newClass(function(){var e=this;this.operations={},this.compositions={},this.operations.Delta=t.newClass(function(){}),this.compositions.modify={modify:[]},this.operations.modify=t.newSubclass(this.operations.Delta,function(t){return function(){t(),this.deltas={}}},{type:"modify",applyTo:function(e,n){var o=this;t.isDefined(n)?(t.assert(e[n]instanceof Object,"The 'modify' operation expects the property to be an already defined Object."),Object.keys(this.deltas).forEach(function(t){o.deltas[t].applyTo(e[n],t)})):(t.assert(e instanceof Object,"The 'modify' operation expects the property to be an already defined Object."),Object.keys(this.deltas).forEach(function(t){o.deltas[t].applyTo(e,t)}))},compose:function(n,o){var i=this;if(o){var r=this.deltas[n],s=e.compositions[r.type][o.type].some(function(t){try{return t(i,n,o),!0}catch(e){}return!1});t.assert(s,"No composition is defined between '"+r.type+"' and '"+o.type+"'.")}return this},modify:function(t){return this._addOperation("modify",t,[])},_addOperation:function(n,o,i){var r=this,s=o.match(/^([.#]?)(\w+|\(\w+\))(.*)$/);if(t.assert(s,"The path string '"+o+"' is not well formed."),"#"===s[1])return this._addOperation(n,".(instance)."+s[2]+s[3],i);var a;return""===s[3]?(!function(t){r.deltas[s[2]]?r.compose(s[2],t):r.deltas[s[2]]=t}(t.applyConstructor(e.operations[n],[s[2]].concat(i))),a=this.deltas[s[2]]):a=this.modify(s[2])._addOperation(n,s[3],i),"modify"===n?a:this},toString:function(){var e=void 0!==arguments[0]?arguments[0]:0,n=void 0!==arguments[1]?arguments[1]:"(root)",o=this;return t.repeat(e,"    ")+"modify '"+n+"'\n"+Object.keys(this.deltas).map(function(t){return o.deltas[t].toString(e+1,t)}).join("\n")}}),this._defineStandardOperationTypes()},{newOperationType:function(e,n){var o=this;t.assert(!this.operations[e],"The '"+e+"' operation type already exists."),this.operations.modify.prototype[e]=function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return this._addOperation(e,t,n)},this.compositions[e]={},Object.keys(this.compositions).forEach(function(n){t.assert(!o.compositions[n][e]),t.assert(!o.compositions[e][n]),o.compositions[n][e]=[],o.compositions[e][n]=[]}),this.operations[e]=t.newSubclass(this.operations.Delta,function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t(),this.a=e}},{type:e,applyTo:n,toString:function(){var n=void 0!==arguments[0]?arguments[0]:0,o=void 0!==arguments[1]?arguments[1]:"(root)";return""+t.repeat(0+n,"    ")+e+" '"+o+"': "+JSON.stringify(this.a).slice(1,-1)}})},newComposition:function(t,e,n){this.compositions[t][e].push(n)},_defineStandardOperationTypes:function(){function e(e,n){t.assert(e instanceof Object,"The operation '"+n+"' expects the property it acts on to be an Object.")}function n(e,n){t.assert(t.isDefined(e),"The operation '"+n+"' expects the property to be defined.")}function o(e,n){t.assert(t.isUndefined(e),"The operation '"+n+"' expects the property to be undefined.")}var i=function(t,e,n){t.deltas[e]=n},r=function(t,e,n){n.applyTo(t.deltas[e].a,0)};this.newComposition("modify","modify",function(t,e,n){Object.keys(n.deltas).forEach(function(e){t.compose(e,n.deltas[e])})}),this.newOperationType("add",function(t,e){o(t[e],"add"),t[e]=this.a[0]}),this.newComposition("add","modify",function(t,n,o){e(t.deltas[n].a[0],"modify"),r(t,n,o)}),this.newOperationType("remove",function(t,e){n(t[e],"remove"),delete t[e]}),this.newComposition("modify","remove",i),this.newComposition("add","remove",i),this.newComposition("remove","add",function(){})}});return e}.apply(e,o),!(void 0!==i&&(t.exports=i))},function(t,e,n){var o;o=function(){"use strict";var t={newClass:function(t){var e=void 0!==arguments[1]?arguments[1]:{},n=t;return n.prototype=e,n.prototype.constructor=n,n},newSubclass:function(e,n){var o=void 0!==arguments[2]?arguments[2]:{},i=n(e.prototype.constructor);return i.prototype=Object.create(e.prototype),t.extend(i.prototype,o),i.prototype.constructor=i,i},extend:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.forEach(function(e){for(var n in e)e.hasOwnProperty(n)&&Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t},array:function(e,n){return t.isUndefined(e[n])&&(e[n]=[]),e[n]},bindA:function(t,e,n){return t.bind.apply(t,[e].concat(n))},bind:function(e,n){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return t.bindA(e[n],e,o)},applyConstructor:function(t,e){var n=t.bind.apply(t,[null].concat(e));return new n},assert:function(t,e){if(!t)throw new Error(e||"Assertion failed")},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},repeat:function(t,e){return new Array(t+1).join(e)}};return t}.call(e,n,e,t),!(void 0!==o&&(t.exports=o))}])});