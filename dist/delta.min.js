!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("js-graph")):"function"==typeof define&&define.amd?define(["js-graph"],t):"object"==typeof exports?exports.DeltaJs=t(require("js-graph")):e.DeltaJs=t(e.JsGraph)}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)["default"]}([function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return D}},__esModule:{value:!0}});var o,r,i,a,u,s=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],l=(r=n(2),r&&r.__esModule&&r||{"default":r})["default"],c=(i=n(3),i&&i.__esModule&&i||{"default":i}),p=c.ReadableTarget,f=c.WritableTarget;s.extend(l,{ReadableTarget:p,WritableTarget:f});var d=(a=n(4),a&&a.__esModule&&a||{"default":a})["default"];s.extend(l,{Path:d});var h=(u=n(5),u&&u.__esModule&&u||{"default":u}),v=h.ApplicationError,g=h.MultipleOverloadsApplicationError,m=h.NoOverloadsApplicationError,_=h.DeltaArgApplicationError,y=h.CompositionError,w=h.MultipleOverloadsCompositionError,b=h.ConstraintFailure,O=h.ApplicationOrderCycle,M=h.UnresolvedConflict;s.extend(l,{ApplicationError:v,MultipleOverloadsApplicationError:g,NoOverloadsApplicationError:m,DeltaArgApplicationError:_,CompositionError:y,MultipleOverloadsCompositionError:w,ConstraintFailure:b,ApplicationOrderCycle:O,UnresolvedConflict:M});var D=l},function(e,t){"use strict";Object.defineProperties(t,{"default":{get:function(){return o}},__esModule:{value:!0}});var n={newClass:function(){var e=void 0!==arguments[0]?arguments[0]:{},t=void 0!==arguments[1]?arguments[1]:{};"function"!=typeof e&&(t=e,e=function(){});var n=e;return n.prototype=t,n.prototype.constructor=n,n},newSubclass:function(e){var t=void 0!==arguments[1]?arguments[1]:{},o=void 0!==arguments[2]?arguments[2]:{};"function"!=typeof t&&(o=t,t=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.apply(this,t)}});var r=t(e.prototype.constructor);return r.prototype=Object.create(e.prototype),n.extend(r.prototype,o),r.prototype.constructor=r,r},extend:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}),e},"default":function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r=t.slice(0,-1),i=t[t.length-1];if(0===r.length)return e;var a=n.o.apply(null,[e].concat(r.slice(0,-1)));return n.isUndefined(a[r[r.length-1]])&&(a[r[r.length-1]]=i),a[r[r.length-1]]},o:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return n["default"].apply(null,[e].concat(t).concat([{}]))},a:function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return n["default"].apply(null,[e].concat(t).concat([[]]))},applyConstructor:function(e,t){var n=Object.create(e.prototype);return e.apply(n,t),n},assert:function(e,t){if(!e)throw new Error(t||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e},repeat:function(e,t){return new Array(e+1).join(t)},indent:function(e,t){var o=void 0!==arguments[2]?arguments[2]:" ";return e.replace(/^(?!\s*$)/gm,n.repeat(t,o))}},o=n},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return S}},__esModule:{value:!0}});var o,r,i,a,u,s,l,c,p,f,d,h,v,g,m,_,y=((o=n(6),o&&o.__esModule&&o||{"default":o})["default"],(r=n(1),r&&r.__esModule&&r||{"default":r})["default"]),w=((i=n(4),i&&i.__esModule&&i||{"default":i})["default"],a=n(3),a&&a.__esModule&&a||{"default":a}),b=(w.ReadableTarget,w.WritableTarget,w.rt,w.wt,u=n(5),u&&u.__esModule&&u||{"default":u}),O=b.ApplicationError,M=(b.MultipleOverloadsApplicationError,b.NoOverloadsApplicationError,b.DeltaArgApplicationError,b.CompositionError),D=(b.MultipleOverloadsCompositionError,(s=n(7),s&&s.__esModule&&s||{"default":s})["default"]),A=(l=n(8),l&&l.__esModule&&l||{"default":l})["default"],C=(c=n(9),c&&c.__esModule&&c||{"default":c})["default"],j=(p=n(10),p&&p.__esModule&&p||{"default":p})["default"],T=(f=n(11),f&&f.__esModule&&f||{"default":f})["default"],E=(d=n(12),d&&d.__esModule&&d||{"default":d})["default"],P=(h=n(13),h&&h.__esModule&&h||{"default":h})["default"],x=(v=n(14),v&&v.__esModule&&v||{"default":v})["default"],R=(g=n(15),g&&g.__esModule&&g||{"default":g})["default"],I=(m=n(16),m&&m.__esModule&&m||{"default":m})["default"],F=(_=n(17),_&&_.__esModule&&_||{"default":_})["default"],S=y.newClass(function(){this._compositions=[],this._overloads={},this._onNewOperationTypeListeners=[],D(this),A(this),C(this),j(this),T(this),E(this),P(this),x(this),R(this),I(this),F(this)},{_evaluatePrecondition:function(e,t){if("function"==typeof e.precondition){var n=e.precondition(t);if(n instanceof O)return n;if(!n)return new O(e,t.value)}return!0},newOperationType:function(e,t,n){var o,r=this;"string"==typeof e&&(o=[void 0,e,t],e=o[0],t=o[1],n=o[2],o),n=n||{};var i=this;y.assert(t[0]===t[0].toUpperCase(),"Delta operations must have a name starting with a capital letter -- '"+t+"' does not."),y.assert(!this.Delta[t],"The '"+t+"' operation type already exists.");var a=this.Delta[t]=y.newSubclass(e||this.Delta,function(e){return function(t,n){e.call(this,t,n),this.construct&&this.construct()}},y.extend({},n,{applyTo:function(e){var t=void 0!==arguments[1]?arguments[1]:{};if((!t.restrictToProperty||!this.options.targetProp||t.restrictToProperty===this.options.targetProp)&&this.selected){var o=i._evaluatePrecondition(this,e);if(o!==!0)throw o;y.isDefined(n.applyTo)&&n.applyTo.call(this,e,this.options.targetProp?y.extend({},t,{restrictToProperty:null}):t)}}}));return a.type=a.prototype.type=t,a.options=a.prototype.options={methods:n.methods||[t[0].toLowerCase()+t.slice(1)]},a.options.methods.forEach(function(e){y.a(r._overloads,e).push(t)}),this._onNewOperationTypeListeners.forEach(function(e){e(a)}),a},onNewOperationType:function(e){var t=this;this._onNewOperationTypeListeners.push(e),Object.keys(this.Delta).forEach(function(n){n[0]===n[0].toUpperCase()&&e(t.Delta[n])})},newComposition:function(e,t){this._compositions.push({precondition:e,compose:t})},composed:function(e,t){y.isUndefined(e)&&(e=new this.Delta.NoOp),y.isUndefined(t)&&(t=new this.Delta.NoOp);var n=function(){},o=this._compositions.some(function(o){var r=o,i=r.precondition,a=r.compose;return i(e,t)?(n=a,!0):void 0});if(!o)throw new M(e,t);return n(e,t)}})},function(e,t,n){"use strict";function o(e,t){return new s(e,t)}function r(e,t){return new u(e,t)}Object.defineProperties(t,{ReadableTarget:{get:function(){return u}},WritableTarget:{get:function(){return s}},wt:{get:function(){return o}},rt:{get:function(){return r}},__esModule:{value:!0}});var i,a=(i=n(1),i&&i.__esModule&&i||{"default":i})["default"],u=a.newClass(function(e){this._val=e},{getValue:function(){return this._val},get value(){return this.getValue()},set value(e){this.setValue(e)}}),s=a.newSubclass(u,function(){return function(e,t){this._obj=e,this._prop=t}},{getValue:function(){return this._obj[this._prop]},setValue:function(e){this._obj[this._prop]=e},"delete":function(){delete this._obj[this._prop]}});u.prototype.chain=function(e){return a.assert(this.value instanceof Object,"The ReadableTarget.prototype.chain method expects the target value to be an Object."),new s(this.value,e)}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return a}},__esModule:{value:!0}});var o,r=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],i=r.newClass(function(){var e=void 0!==arguments[0]?arguments[0]:"",t=e.match(/^([.#]?)(\w*|\(\w+\))(.*)$/);r.assert(t,"The path string '"+e+"' is not well formed.");var n=t,o=n[1],a=n[2],u=n[3];"#"===o?this.set(new i(".(instance)."+a+u)):""!==a&&(this._prop=a,""!==u&&(this._rest=new i(u)))},{set:function(e){this._prop=e._prop,this._rest=e._rest},get prop(){return this._prop},get rest(){return this._rest}}),a=i},function(e,t,n){"use strict";Object.defineProperties(t,{ApplicationError:{get:function(){return i}},MultipleOverloadsApplicationError:{get:function(){return a}},NoOverloadsApplicationError:{get:function(){return u}},DeltaArgApplicationError:{get:function(){return s}},CompositionError:{get:function(){return l}},MultipleOverloadsCompositionError:{get:function(){return c}},ConstraintFailure:{get:function(){return p}},ApplicationOrderCycle:{get:function(){return f}},DeltaConflict:{get:function(){return d}},__esModule:{value:!0}});var o,r=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],i=r.newSubclass(Error,function(e){return function(t,n){e.call(this),this.name="ApplicationError",this.message="This delta of type '"+t.type+"' cannot apply to this value of type '"+typeof n+"'.",this.delta=t,this.value=n}}),a=r.newSubclass(i,function(e){return function(t,n){var o=void 0!==arguments[2]?arguments[2]:[];e.call(this,t,n),this.name="MultipleOverloadsApplicationError",this.message="None of these deltas of types "+t.overloads.map(function(e){return"'"+e.type+"'"}).join(",")+" can apply to this value of type '"+typeof n+"."+o.map(function(e){return"\n-- "+e.message}).join(""),this.errors=o}}),u=r.newSubclass(i,function(e){return function(t,n){e.call(this,t,n),this.name="NoOverloadsApplicationError",this.message="This delta of type '"+t.type+"' has no spcific deltas assigned to it, so it cannot apply to this value of type '"+typeof n+"."}}),s=r.newSubclass(i,function(e){return function(t,n){e.call(this,t,n.arg),this.name="DeltaArgApplicationError",this.message="This delta of type '"+t.type+"' cannot apply to the type-'"+typeof n.arg+"'-value of this base delta of type '"+n.type+"'.",this.baseDelta=n}}),l=r.newSubclass(Error,function(e){return function(t,n){e.call(this),this.name="CompositionError",this.message="This delta of type '"+t.type+"' cannot be composed with this other delta of type '"+n.type+"'.",this.delta1=t,this.delta2=n}}),c=r.newSubclass(l,function(e){return function(t,n){var o=void 0!==arguments[2]?arguments[2]:[];e.call(this,t,n),this.name="MultipleOverloadsCompositionError",this.message="There are no overloads to compose this delta of type '"+t.type+"' with this other delta of type '"+n.type+"'."+o.map(function(e){return"\n-- "+e.message}).join(""),this.errors=o}}),p=r.newSubclass(Error,function(e){return function(t){e.call(this),this.name="ConstraintFailure",this.message="The feature '"+t.name+"' is both selected and excluded by its constraints.",this.feature=t}}),f=r.newSubclass(Error,function(e){return function(t,n){e.call(this),this.name="ApplicationOrderCycle",this.message="The new application order between "+t+" and "+n+" created a cycle.",this.from=t,this.to=n}}),d=r.newSubclass(Error,function(e){return function(t){e.call(this),this.name="DeltaConflict";var n=t.map(function(e){return"'"+e.name+"'"}).join(",");this.message="There is an unresolved conflict between deltas "+n+".",this.deltas=t}})},function(t){t.exports=e},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return c}},__esModule:{value:!0}});var o,r,i,a=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],u=(r=n(3),r&&r.__esModule&&r||{"default":r}),s=u.ReadableTarget,l=u.wt,c=((i=n(17),i&&i.__esModule&&i||{"default":i})["default"],function(e){a.isDefined(e.Delta)||(e._nextDeltaID=0,e.Delta=a.newClass(function(t){var n=void 0!==arguments[1]?arguments[1]:{};this.arg=t,this.id=e._nextDeltaID++,this.options=n},{clone:function(){return new this.constructor(this.arg,this.options)},appliedTo:function(e){var t=void 0!==arguments[1]?arguments[1]:{};e instanceof s&&(e=e.value),"function"==typeof e.clone&&(e=e.clone());var n={value:e};return this.applyTo(l(n,"value"),t),n.value},composedWith:function(t){return e.composed(this,t)},toString:function(){var e=void 0!==arguments[0]?arguments[0]:{},t=this.type;return this.options.targetProp&&(t+=" ‹"+this.options.targetProp+"›"),a.isDefined(this.arg)&&(t+=": "+JSON.stringify(this.arg)),e.debug&&(t+=" ("+this.id+")"),t}}))})},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return u}},__esModule:{value:!0}});var o,r,i=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],a=(r=n(7),r&&r.__esModule&&r||{"default":r})["default"],u=function(e){if(!i.isDefined(e.Delta.Composite)){a(e),i.extend(e.constructor.prototype,{_newDeltaByMethod:function(e,t){var n=this,o=this._overloads[e.method].map(function(o){return new n.Delta[o](t,e)});if(1===o.length)return o[0];var r=new this.Delta.Overloaded(t,e);return r.overloads=o,r}}),e.Delta.Composite=i.newSubclass(e.Delta,function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.apply(this,t)}},{operation:function(){throw new Error("A Delta.Composite subclass needs to implement the 'operation' method.")},"do":function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var o=this,r=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o["do"].apply(o,r._args.concat(e))};return r._args=e,i.extend(r,t,{_applyOperationMethod:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return{newDelta:o.operation.apply(o,[{method:e}].concat(r._args).concat(t)),fcdArgs:r._args}},delta:o}),r}});var t={};e.onNewOperationType(function(n){n!==e.Delta.Composite&&(n.options.methods||[]).forEach(function(n){i.isUndefined(t[n])&&(t[n]=function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var r=this._applyOperationMethod.apply(this,[n].concat(t)),i=r.newDelta,a=r.fcdArgs;return i instanceof e.Delta.Composite?i["do"]():this.delta["do"].apply(this.delta,a)})})})}}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return f}},__esModule:{value:!0}});var o,r,i,a=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],u=(r=n(7),r&&r.__esModule&&r||{"default":r})["default"],s=(i=n(5),i&&i.__esModule&&i||{"default":i}),l=s.MultipleOverloadsApplicationError,c=s.NoOverloadsApplicationError,p=s.MultipleOverloadsCompositionError,f=function(e){a.isDefined(e.Delta.Overloaded)||(u(e),e.newOperationType(e.Delta,"Overloaded",{construct:function(){this.overloads=[]},clone:function(){var t=e.Delta.prototype.clone.call(this,this.arg,this.options);return t.overloads=this.overloads.map(function(e){return e.clone()}),t},applyTo:function(t){var n=void 0!==arguments[1]?arguments[1]:{},o=[],r=this.overloads.some(function(r){var i=e._evaluatePrecondition(r,t);return i!==!0?(o.push(i),!1):(r.applyTo(t,n),!0)});if(!r)throw 0===o.length?new c(this,t.value):1===o.length?o[0]:new l(this,t.value,o)},toString:function(t){var n=e.Delta.prototype.toString.call(this,t),o=this.overloads.map(function(e){return e.toString(t)}).join("\n");return n+="\n"+a.indent(o,4)}}),e.newComposition(function(t,n){return t instanceof e.Delta.Overloaded||n instanceof e.Delta.Overloaded},function(t,n){var o=t instanceof e.Delta.Overloaded?t.overloads:[t],r=n instanceof e.Delta.Overloaded?n.overloads:[n],i=new e.Delta.Overloaded,a=[];if(o.forEach(function(e){r.forEach(function(t){try{i.overloads.push(e.composedWith(t))}catch(n){a.push(n)}})}),0===i.overloads.length)throw new p(t,n,a);return i}))}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return p}},__esModule:{value:!0}});var o,r,i,a,u=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],s=(r=n(4),r&&r.__esModule&&r||{"default":r})["default"],l=(i=n(3),i&&i.__esModule&&i||{"default":i}).wt,c=(a=n(8),a&&a.__esModule&&a||{"default":a})["default"],p=function(e){u.isDefined(e.Delta.Modify)||(c(e),e.newOperationType(e.Delta.Composite,"Modify",{construct:function(){this.deltas={}},clone:function(){var t=this,n=e.Delta.prototype.clone.call(this,this.arg,this.options);return Object.keys(this.deltas).forEach(function(e){n.deltas[e]=t.deltas[e].clone()}),n},precondition:function(e){return e.value instanceof Object},applyTo:function(e){var t=void 0!==arguments[1]?arguments[1]:{},n=this;Object.keys(this.deltas).forEach(function(o){n.deltas[o].applyTo(l(e.value,o),t)})},toString:function(t){var n=this,o=e.Delta.prototype.toString.call(this,t);if(Object.keys(this.deltas).length>0){var r=Object.keys(this.deltas).map(function(e){return n.deltas[e].toString(t)}).join("\n");o+="\n"+u.indent(r,4)}return o},operation:function(t,n,o){for(var r,i=[].slice.call(arguments,0),a={};"object"==typeof i[0];)u.extend(a,i.shift());r=i,n=r[0],o=r[1],r;var l=e._newDeltaByMethod(a,o);return this._addOperation(a,new s(n),l)},_addOperation:function(t,n,o){return n.rest?this.operation({method:"modify"},n.prop)._addOperation(t,n.rest,o):(this.deltas[n.prop]=this.deltas[n.prop]?this.deltas[n.prop].composedWith(o):o,this.deltas[n.prop].options.targetProp=n.prop,this.deltas[n.prop]instanceof e.Delta.Composite?this.deltas[n.prop]:o)}}))}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return d}},__esModule:{value:!0}});var o,r,i,a,u=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],s=(r=n(3),r&&r.__esModule&&r||{"default":r}),l=s.WritableTarget,c=(s.ReadableTarget,s.rt,s.wt),p=(i=n(5),i&&i.__esModule&&i||{"default":i}).DeltaArgApplicationError,f=(a=n(7),a&&a.__esModule&&a||{"default":a})["default"],d=function(e){function t(e,t){return function(n,o){return n.type===e&&o.type===t}}function n(t,n){return"string"==typeof n&&(n=function(e){return function(t){return t[e]}}(n)),function(o,r){return new e.Delta[t](n&&n({d1:o,d2:r,p1:o.arg,p2:r.arg}))}}if(!u.isDefined(e._basicOperationsDefined)){e._basicOperationsDefined=!0,f(e);var o=e.newOperationType("NoOp");e.newComposition(function(e){return e instanceof o},function(e,t){return t.clone()}),e.newComposition(function(e,t){return t instanceof o},function(e){return e.clone()}),[["Add","add",function(e){return u.isUndefined(e.value)}],["Replace","replace",function(e){return u.isDefined(e.value)}]].forEach(function(t){var n=t,o=n[0],r=(n[1],n[2]);e.newOperationType(o,{construct:function(){this.deltasToApplyToArg=[]},precondition:function(e){return e instanceof l&&r(e)},applyTo:function(e){e.value=this.deltasToApplyToArg.reduce(function(e,t){return t.appliedTo(e)},this.arg)},clone:function(){var t=e.Delta.prototype.clone.call(this,this.arg,this.options);return t.deltasToApplyToArg=this.deltasToApplyToArg.map(function(e){return e}),t},afterApplying:function(t){var n=this.clone();if(n.deltasToApplyToArg.push(t),n.deltasToApplyToArg.reduce(function(t,n){return e.composed(t,n)}).precondition(c(n,"arg"))!==!0)throw new p(t,this);return n},toString:function(t){var n=this,o=e.Delta.prototype.toString.call(this,t);if(Object.keys(this.deltasToApplyToArg).length>0){var r=Object.keys(this.deltasToApplyToArg).map(function(e){return n.deltasToApplyToArg[e].toString(t)}).join("\n");o+="\n"+u.indent(r,4)}return o}})}),e.newOperationType("Remove",{precondition:function(e){return e instanceof l&&u.isDefined(e.value)},applyTo:function(e){e["delete"]()}}),e.newOperationType("Forbid",{precondition:function(e){return u.isUndefined(e.value)}}),e.newComposition(t("Modify","Modify"),function(t,n){var o=t.clone();return Object.keys(n.deltas).forEach(function(t){o.deltas[t]=e.composed(o.deltas[t],n.deltas[t])}),o}),e.newComposition(t("Add","Modify"),function(e,t){return e.afterApplying(t)}),e.newComposition(t("Modify","Remove"),n("Remove")),e.newComposition(t("Add","Remove"),n("Forbid")),e.newComposition(t("Remove","Add"),n("Replace",function(e){var t=e.p2;return t})),e.newComposition(t("Remove","Forbid"),n("Remove")),e.newComposition(t("Forbid","Add"),n("Add",function(e){var t=e.p2;return t})),e.newComposition(t("Forbid","Forbid"),n("Forbid")),e.newComposition(t("Modify","Replace"),n("Replace",function(e){var t=e.p2;return t})),e.newComposition(t("Add","Replace"),n("Add",function(e){var t=e.p2;return t})),e.newComposition(t("Replace","Modify"),function(e,t){return e.afterApplying(t)}),e.newComposition(t("Replace","Remove"),n("Remove")),e.newComposition(t("Replace","Replace"),n("Replace",function(e){var t=e.p2;return t}))}}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return c}},__esModule:{value:!0}});var o,r,i,a,u=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],s=(r=n(3),r&&r.__esModule&&r||{"default":r}),l=(s.WritableTarget,s.ReadableTarget,s.rt,s.wt,(i=n(5),i&&i.__esModule&&i||{"default":i}).DeltaArgApplicationError,(a=n(11),a&&a.__esModule&&a||{"default":a})["default"]),c=function(e){function t(e,t){return function(n,o){return n.type===e&&o.type===t}}function n(t,n){return"string"==typeof n&&(n=function(e){return function(t){return t[e]}}(n)),function(o,r){return new e.Delta[t](n&&n({d1:o,d2:r,p1:o.arg,p2:r.arg}))}}u.isDefined(e.Delta.PutIntoArray)||(l(e),e.newOperationType("PutIntoArray",{construct:function(){this.values=this.options.method?[{method:this.options.method,value:this.arg}]:[]},clone:function(){var t=e.Delta.prototype.clone.call(this,this.arg,this.options);return t.values=[],this.values.forEach(function(e){t.values.push(e)}),t},precondition:function(e){return u.isDefined(e.value)&&Array.isArray(e.value)},applyTo:function(e){var t=e.value;this.values.forEach(function(e){var n=e,o=n.method,r=n.value;switch(o){case"prepend":t.unshift(r);break;case"insert":var i=Math.floor(Math.random()*(t.length+1));t.splice(i,0,r);break;case"append":t.push(r)}})},methods:["prepend","insert","append"]}),e.newComposition(t("Add","PutIntoArray"),function(e,t){return e.afterApplying(t)}),e.newComposition(t("Replace","PutIntoArray"),function(e,t){return e.afterApplying(t)}),e.newComposition(t("PutIntoArray","Remove"),n("Remove")),e.newComposition(t("PutIntoArray","Replace"),n("Replace",function(e){var t=e.p2;return t})),e.newComposition(t("PutIntoArray","PutIntoArray"),function(t,n){var o=new e.Delta.PutIntoArray;return o.values=t.values.concat(n.values),o}))}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return l}},__esModule:{value:!0}});var o,r,i,a=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],u=(r=n(3),r&&r.__esModule&&r||{"default":r}).WritableTarget,s=(i=n(11),i&&i.__esModule&&i||{"default":i})["default"],l=function(e){function t(e,t){return function(n,o){return n.type===e&&o.type===t}}function n(t,n){return"string"==typeof n&&(n=function(e){return function(t){return t[e]}}(n)),function(o,r){return new e.Delta[t](n&&n({d1:o,d2:r,p1:o.arg,p2:r.arg}))}}a.isDefined(e.Delta.PutIntoFunction)||(s(e),e.newOperationType("PutIntoFunction",{construct:function(){this.values=this.options.method?[{method:this.options.method,value:this.arg}]:[]},clone:function(){var t=e.Delta.prototype.clone.call(this,this.arg,this.options);return t.values=[],this.values.forEach(function(e){t.values.push(e)}),t},precondition:function(e){return a.isDefined(e.value)&&"function"==typeof e.value&&(a.isDefined(e.value._DeltaJs_functions)||e instanceof u)},applyTo:function(e){if(a.isUndefined(e.value._DeltaJs_functions)){var t=e.value,n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var o,r=this;return n._DeltaJs_functions.forEach(function(t){o=t.apply(r,e)}),o};n._DeltaJs_functions=[function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.apply(this,e)}],e.value=n}var o=e.value._DeltaJs_functions;this.values.forEach(function(e){var t=e,n=t.method,r=t.value;switch(n){case"prepend":o.unshift(r);break;case"insert":var i=Math.floor(Math.random()*(o.length+1));o.splice(i,0,r);break;case"append":o.push(r)}})},methods:["prepend","insert","append"]}),e.newComposition(t("Add","PutIntoFunction"),function(e,t){return e.afterApplying(t)}),e.newComposition(t("Replace","PutIntoFunction"),function(e,t){return e.afterApplying(t)}),e.newComposition(t("PutIntoFunction","Remove"),n("Remove")),e.newComposition(t("PutIntoFunction","Replace"),n("Replace",function(e){var t=e.p2;return t})),e.newComposition(t("PutIntoFunction","PutIntoFunction"),function(t,n){var o=new e.Delta.PutIntoFunction;return o.values=t.values.concat(n.values),o}))}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return d}},__esModule:{value:!0}});var o,r,i,a,u,s=(o=n(6),o&&o.__esModule&&o||{"default":o})["default"],l=(r=n(5),r&&r.__esModule&&r||{"default":r}).ApplicationOrderCycle,c=(i=n(1),i&&i.__esModule&&i||{"default":i})["default"],p=(a=n(4),a&&a.__esModule&&a||{"default":a})["default"],f=(u=n(8),u&&u.__esModule&&u||{"default":u})["default"],d=function(e){if(!c.isDefined(e.Delta.DeltaModel)){f(e);var t=e.newOperationType(e.Delta.Composite,"DeltaModel",{construct:function(){this.graph=new s},clone:function(){var e=new t;return e.graph=this.graph.clone(),e.graph.eachVertex(function(t,n){e.graph.setVertex(t,n.clone())}),e},applyTo:function(e){var t=void 0!==arguments[1]?arguments[1]:{};this.graph.topologically(function(n,o){o.applyTo(e,t)})},operation:function(t,n,o,r,i){for(var a,u=[].slice.call(arguments),s={};"object"==typeof u[0];)c.extend(s,u.shift());for(n=u.shift();"object"==typeof u[0];)c.extend(s,u.shift());a=u,r=a[0],i=a[1],a;var l=e._newDeltaByMethod(s,i);return this._addOperation(n,s,new p(r),l)},toString:function(t){var n=e.Delta.prototype.toString.call(this,t);if(this.graph.vertexCount()>0){var o="";this.graph.topologically(function(e,n){o+="["+e+"] "+n.toString(t)+"\n"}),n+="\n"+c.indent(o,4)}return n},_addOperation:function(t,n,o,r){var i=this,a=c.isDefined(this.graph.vertexValue(t)),u=r;if(o.prop&&(u=new e.Delta.Modify,u._addOperation(n,o,r)),a){var s=this.graph.vertexValue(t);u=s.composedWith(u),u.name=s.name,u.applicationCondition=s.applicationCondition,this.graph.setVertex(t,u)}else{u.name=t,this.graph.addVertex(t,u),(n.combines||[]).concat(n.after||[]).forEach(function(e){if(i.graph.createEdge(e,t),i.graph.hasCycle())throw i.graph.removeExistingEdge(e,t),new l(e,t)});var p;p=n.feature?e.newFeature(t,n):e.newFeature("delta__"+t,c.extend({hidden:!0},n)),(n.feature||p.conditional)&&(u.applicationCondition=p),c.isDefined(n.combines)&&p["if"](n.combines)}return r}});e.newComposition(function(e,n){return e instanceof t||n instanceof t},function(e,n){var o=new t;return o.graph.addNewVertex(1,e),o.graph.addNewVertex(2,n),o.graph.addNewEdge(1,2),o})}}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return u}},__esModule:{value:!0}});var o,r,i=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],a=(r=n(5),r&&r.__esModule&&r||{"default":r}).ConstraintFailure,u=function(e){function t(t){return t=Array.isArray(t)?t:[t],t=t.map(function(t){return t instanceof e.Feature?t.name:t})}function n(e){var n=void 0!==arguments[1]?arguments[1]:[];d=!0,n===!0?c[e]=!0:n===!1||l[e]!==!0&&i.a(l,e).push(t(n))}function o(e,o){t(o).forEach(function(t){n(t,e)})}function r(e){var n=void 0!==arguments[1]?arguments[1]:[];d=!0,n===!1?f[e]=!1:n===!0||p[e]!==!1&&i.a(p,e).push(t(n))}function u(e,n){t(n).forEach(function(t){r(t,e)})}function s(){if(d){d=!1;var t;do t=!1,Object.keys(e.features).forEach(function(e){c[e]||(i.isUndefined(c[e])&&(c[e]=!1),(l[e]||[]).some(function(e){return e.every(function(e){return c[e]})})&&(c[e]=!0,t=!0))});while(t);Object.keys(e.features).forEach(function(e){f[e]=(p[e]||[]).every(function(e){return e.some(function(e){return c[e]})})})}}if(!e._featuresImplemented){e._featuresImplemented=!0;var l={},c={},p={},f={},d=!1;e.Feature=i.newClass(function(e){var t=void 0!==arguments[1]?arguments[1]:{},n=this;this.name=e,this.options=t,Object.keys(t).forEach(function(e){n.addOption(e,t[e])})},{get selected(){if(s(),c[this.name]&&!f[this.name])throw new a(this);return c[this.name]},get condition(){return l[this.name]},get conditional(){return i.a(l,this.name).length>0},get restricted(){return i.a(p,this.name).length>0},select:function(){this["if"](!0)}});var h=[["if",[n,u]],["onlyIf",[r]],["selects",[o,r]],["requiredBy",[u]],["iff",[n,u,r]]];e.Feature.prototype.addOption=function(e,t){var n=this;h.forEach(function(o){var r=o,i=r[0],a=r[1];e===i&&a.forEach(function(e){e(n.name,t)})})},h.forEach(function(t){var n=t[0];e.Feature.prototype[n]=function(e){this.addOption(n,e)}}),e.features={},i.isDefined(e.constructor._featuresImplemented)||(e.constructor._featuresImplemented=!0,i.extend(e.constructor.prototype,{newFeature:function(e){var t=void 0!==arguments[1]?arguments[1]:{};return i.assert(i.isUndefined(this.features[e]),"A feature with the name '"+e+"' already exists."),this.features[e]=new this.Feature(e,t)}}))}}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return l}},__esModule:{value:!0}});var o,r,i,a=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],u=(r=n(3),r&&r.__esModule&&r||{"default":r}).rt,s=(i=n(14),i&&i.__esModule&&i||{"default":i})["default"],l=function(e){var t;s(e),e._variationPointsImplemented||(e._variationPointsImplemented=!0,e._deltaModel=new e.Delta.DeltaModel,a.isDefined(e.constructor._variationPointsImplemented)||(e.constructor._variationPointsImplemented=!0,a.extend(e.constructor.prototype,(t={},Object.defineProperty(t,"vp",{value:function(e,t){var n,o=(n={},Object.defineProperty(n,e,{value:t,configurable:!0,enumerable:!0,writable:!0}),n);return this._deltaModel.applyTo(u(o),{restrictToProperty:e}),o[e]},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,"operation",{value:function(){return this._deltaModel.operation.apply(this._deltaModel,arguments)},configurable:!0,enumerable:!0,writable:!0}),Object.defineProperty(t,"do",{value:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._deltaModel["do"].apply(this._deltaModel,[{feature:!0}].concat(e))},configurable:!0,enumerable:!0,writable:!0}),t))))}},function(e,t,n){"use strict";Object.defineProperties(t,{"default":{get:function(){return i}},__esModule:{value:!0}});var o,r=(o=n(1),o&&o.__esModule&&o||{"default":o})["default"],i=function(e){e._applicationConditionsImplemented||(e._applicationConditionsImplemented=!0,r.extend(e.Delta.prototype,{get applicationCondition(){return this._applicationCondition},set applicationCondition(e){this._applicationCondition=e},get selected(){return r.isUndefined(this.applicationCondition)||this.applicationCondition.selected}}),r.isDefined(e.constructor._applicationConditionsImplemented)||(e.constructor._applicationConditionsImplemented=!0,r.extend(e.constructor.prototype,{select:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=this;e.forEach(function(e){Array.isArray(e)?n.select.apply(n,e):n.features[e].select()})}})))}}])});