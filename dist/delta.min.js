!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("js-graph")):"function"==typeof define&&define.amd?define(["js-graph"],t):"object"==typeof exports?exports.DeltaJs=t(require("js-graph")):e.DeltaJs=t(e.JsGraph)}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var o,i;o=[n(1),n(2)],i=function(e,t){"use strict";function n(e,n){t.assert("function"==typeof e,"The operation '"+n+"' expects the property it acts on to be a function.")}function o(e,n){t.assert(t.isDefined(e),"The operation '"+n+"' expects the property to be defined.")}function i(e,n){t.assert(t.isUndefined(e),"The operation '"+n+"' expects the property to be undefined.")}var r=t.newClass(function(){var e={},n=[];t.extend(this,{_addOperationType:function(o){var i=o,r=i.name,a=i.constructor,s=i.applyTo,p=i.prototype,u=i.method,f={};e[r]={name:r,Delta:a,method:f[r]},t.extend(e[r].Delta.prototype,p,{constructor:a,type:r,applyTo:s,compose:function(e,o){var i=this;if(t.isUndefined(o))return this;var r;if(n.some(function(e){var t=e,n=t.op1Type,a=t.op2Type,s=t.composeFn;return i.type===n&&o.type===a?(r=s,!0):void 0}),!r){var a=new Error("You cannot follow a '"+this.type+"' operation "+("with a '"+o.type+"' operation on the same property."));throw a.op1=this.type,a.op2=o.type,a}r(this,e,o)}}),e.modify.Delta.prototype[r]=t.isDefined(u)?u:function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return this._addOperation(e[r],t,n),this}},_addOperationAlias:function(t){var n=t,o=n.name,i=n.target,r=n.transform,a={};Object.defineProperty(a,o,{value:function(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return this._addOperation(e[i],t,r(n)),this}}),e[o]={name:o,method:a[o]},e.modify.Delta.prototype[o]=e[o].method},_addCompositionRule:function(e,t,o){n.push({op1Type:e,op2Type:t,composeFn:o})},_newDelta:function(n){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return t.applyConstructor(e[n].Delta,o)}}),Object.defineProperty(this,"ModifyDelta",{get:function(){return e.modify.Delta}});var o=this;this._addOperationType({name:"modify",constructor:function(n,o){var i=this;n=n||{},this.operations=o||{},Object.keys(n).forEach(function(o){var r=o.match(/^(\w+)\s+([\w\.]+)$/);if(r){var a=r[1],s=r[2];t.assert(a in e,"I don't know the '"+a+"' operation."),i[a](s,n[o])}})},applyTo:function(e,n){var o=this;t.isDefined(n)?(t.assert(t.isDefined(e[n]),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){o.operations[t].applyTo(e[n],t)})):(t.assert(t.isDefined(e),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){o.operations[t].applyTo(e,t)}))},prototype:{selectivelyApplyTo:function(e,n){t.assert(t.isDefined(e),"The 'modify' operation expects the property to be already defined."),t.isDefined(this.operations[n])&&this.operations[n].applyTo(e,n)},_addOperation:function(n,i,r){var a=i.indexOf(".");if(-1!==a){var s=i.slice(0,a),p=i.slice(a+1),u=this._addOperation(e.modify,s);return u[n.name].apply(u,[p].concat(r))}var f=o._newDelta.apply(o,[n.name].concat(r));return this.operations.hasOwnProperty(i)&&t.isDefined(this.operations[i])?this.compose(i,f):this.operations[i]=f,this.operations[i]}},method:function(t,n){return this._addOperation(e.modify,t,[n])}})}),a=function(){},s=function(e,t,n){e[t]=n},p=function(e,t,n){n.applyTo(e[t],"value")},u=t.newSubclass(r,function(){var e=this;this._addOperationType({name:"add",constructor:function(e){this.value=e},applyTo:function(e,t){i(e[t],"add"),e[t]=this.value}}),this._addOperationType({name:"replace",constructor:function(e){this.value=e},applyTo:function(e,t){o(e[t],"replace"),e[t]=this.value}}),this._addOperationType({name:"remove",constructor:function(){},applyTo:function(e,t){o(e[t],"remove"),delete e[t]}}),this._addOperationType({name:"forbid",constructor:function(){},applyTo:function(e,t){i(e[t],"forbid")}}),this._addCompositionRule("add","replace",function(e,t,n){e[t]=r._newDelta("add",n.value)}),this._addCompositionRule("add","modify",p),this._addCompositionRule("add","remove",function(e,t){e[t]=r._newDelta("forbid")}),this._addCompositionRule("replace","replace",s),this._addCompositionRule("replace","modify",p),this._addCompositionRule("replace","remove",s),this._addCompositionRule("modify","replace",s),this._addCompositionRule("modify","modify",function(e,t,n){Object.keys(n.operations).forEach(function(t){e.compose(t,n.operations[t])})}),this._addCompositionRule("modify","remove",s),this._addCompositionRule("remove","add",function(e,t,n){e[t]=r._newDelta("replace",n.value)}),this._addCompositionRule("remove","forbid",a),this._addCompositionRule("forbid","add",s),this._addCompositionRule("forbid","forbid",a),this._addOperationType({name:"alter",constructor:function(e,t){this.value=e||[],this.alias=t||"alter"},applyTo:function(e,t){n(e[t],this.alias),this.value.forEach(function(n){var o=e[t],i=n.value;e[t]="prepend"===n.type?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(this,e),o.apply(this,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(this,e),i.apply(this,e)}})}}),this._addCompositionRule("alter","alter",function(e,t,n){[].push.apply(e[t].value,n.value)}),this._addCompositionRule("alter","replace",s),this._addCompositionRule("alter","remove",function(e,t){e[t]=r._newDelta("forbid")}),this._addCompositionRule("add","alter",function(e,t,o){n(e[t].value,o.alias),p(e,t,o)}),this._addCompositionRule("replace","alter",function(e,t,o){n(e[t].value,o.alias),p(e,t,o)}),["prepend","insert","append"].forEach(function(t){e._addOperationAlias({name:t,target:"alter",transform:function(e){return[[{type:t,value:e[0]}],t]}})}),this._addOperationType({name:"after",constructor:function(e){this.value=e},applyTo:function(e,t){n(e[t],"after");var o=e[t],i=this.value;e[t]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return c(o.apply(this,e)).then(function(){return i.apply(this,e)}.bind(this))}}}),this._addCompositionRule("after","replace",s),this._addCompositionRule("after","remove",s),this._addCompositionRule("add","after",function(e,t,o){n(e[t].value,"after"),p(e,t,o)}),this._addCompositionRule("replace","after",function(e,t,o){n(e[t].value,"after"),p(e,t,o)}),this._addCompositionRule("insert","after",p),this._addCompositionRule("after","insert",p)}),f=t.newSubclass(u,function(){function n(e,n){s=!0,n===!0?a[e]=!0:n===!1||r[e]!==!0&&t.array(r,e).push(n)}function o(){if(s){s=!1;var e;do e=!1,i.eachVertex(function(n){a[n]||t.isUndefined(r[n])||r[n].some(function(e){return e.every(function(e){return a[e]})})&&(a[n]=!0,e=!0)});while(e)}}var i=new e;t.extend(this,{graph:function(){return i}});var r={},a={},s=!1;t.extend(this,{Delta:function(e,r){t.assert(r instanceof Object,"A delta should be given as an object."),this.ModifyDelta.apply(this,r),Object.defineProperties(this,{name:{get:function(){return e}},manuallySelectable:{get:function(){return t.isDefined(r.manuallySelectable)?!!r.manuallySelectable:t.isDefined(r.resolves)&&r.resolves.length>0?!1:!0}},selected:{get:function(){return o(),!!a[e]}},"if":{get:function(){return r["if"]===!0||r["if"]===!1?r["if"]:r["if"]||r.iff||r.resolves?[].concat(r["if"]||[],r.iff||[],r.resolves||[]):!1}},onlyIf:{get:function(){return r.onlyIf===!0||r.onlyIf===!1?r.onlyIf:r.onlyIf||r.iff||r.expects||r.resolves?[].concat(r.onlyIf||[],r.iff||[],r.expects||[],r.resolves||[]):!0}},after:{get:function(){return[].concat(r.after||[],r.expects||[],r.resolves||[],r.requires||[])}},selects:{get:function(){return[].concat(r.selects||[],r.requires||[])}}}),s=!0,t.isDefined(this.if)&&n(e,this.if),this.selects.forEach(function(t){n(t,[e])}),i.addVertex(e,this),this.after.forEach(function(t){i.createEdge(t,e)}),t.assert(!i.hasCycle(),"The delta "+e+" introduced a cycle in the application order.")},select:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.forEach(function(e){n(e,!0)})},vp:function(e,n){var r={};return r[e]=n,o(),i.eachVertex(function(e,n){t.assert(!n.selected||n.onlyIf.every(function(e){return i.vertexValue(e).selected}),"The 'onlyIf' condition of delta '"+n.name+"' was violated.")}),i.topologically(function(e,t){t.selected&&t.selectivelyApplyTo(r,e)}),r[e]}})}),c=null;return t.extend(f,{registerPromiseResolver:function(e){c=e}}),f}.apply(t,o),!(void 0!==i&&(e.exports=i))},function(t){t.exports=e},function(e,t,n){var o;o=function(){"use strict";var e={newClass:function(e,t){t=t||{};var n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.apply(this,t)};return n.prototype=t,n.prototype.constructor=n,n},newSubclass:function(e,t,n){n=n||{};var o=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];e.prototype.constructor.apply(this,n),t.apply(this,n)};return o.prototype=Object.create(e.prototype,n),o.prototype.constructor=o,o},extend:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e},array:function(t,n){return e.isUndefined(t[n])&&(t[n]=[]),t[n]},bindA:function(e,t,n){return e.bind.apply(e,[t].concat(n))},bind:function(t,n){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return e.bindA(t[n],t,o)},applyConstructor:function(e,t){var n=e.bind.apply(e,[null].concat(t));return new n},assert:function(e,t){if(!e)throw new Error(t||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e}};return e}.call(t,n,t,e),!(void 0!==o&&(e.exports=o))}])});