!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("js-graph")):"function"==typeof define&&define.amd?define(["js-graph"],e):"object"==typeof exports?exports.DeltaJs=e(require("js-graph")):t.DeltaJs=e(t.JsGraph)}(this,function(t){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=r(n(1)),i=r(n(2)),a=n(3),s=a.ReadableTarget,u=a.WritableTarget;o.extend(i,{ReadableTarget:s,WritableTarget:u});var c=r(n(4));o.extend(i,{Path:c});var l=n(5),p=l.ApplicationError,f=l.MultipleOverloadsApplicationError,d=l.NoOverloadsApplicationError,h=l.DeltaArgApplicationError,v=l.CompositionError,y=l.MultipleOverloadsCompositionError,g=l.ConstraintFailure,m=l.ApplicationOrderCycle,w=l.UnresolvedConflict,A=l.MultipleActiveFacadesError;o.extend(i,{ApplicationError:p,MultipleOverloadsApplicationError:f,NoOverloadsApplicationError:d,DeltaArgApplicationError:h,CompositionError:v,MultipleOverloadsCompositionError:y,ConstraintFailure:g,ApplicationOrderCycle:m,UnresolvedConflict:w,MultipleActiveFacadesError:A}),t.exports=i},function(t){"use strict";var e=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},n={newClass:function(){var t=void 0===arguments[0]?{}:arguments[0],e=void 0===arguments[1]?{}:arguments[1];"function"!=typeof t&&(e=t,t=function(){});var n=t;return n.prototype=e,n.prototype.constructor=n,n},newSubclass:function(t){var e=void 0===arguments[1]?{}:arguments[1],r=void 0===arguments[2]?{}:arguments[2];"function"!=typeof e&&(r=e,e=function(t){return function(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];t.apply(this,n)}});var o=e(t.prototype.constructor);return o.prototype=Object.create(t.prototype),n.extend(o.prototype,r),o.prototype.constructor=o,o},extend:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return n.forEach(function(e){for(var n in e)e.hasOwnProperty(n)&&Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n))}),t},"default":function(t){for(var r=arguments.length,o=Array(r>1?r-1:0),i=1;r>i;i++)o[i-1]=arguments[i];var a=o.slice(0,-1),s=o[o.length-1];if(0===a.length)return t;var u=n.o.apply(n,[t].concat(e(a.slice(0,-1))));return n.isUndefined(u[a[a.length-1]])&&(u[a[a.length-1]]=s),u[a[a.length-1]]},o:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;e>o;o++)r[o-1]=arguments[o];return n["default"].apply(n,[t].concat(r,[{}]))},a:function(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;e>o;o++)r[o-1]=arguments[o];return n["default"].apply(n,[t].concat(r,[[]]))},assert:function(t,e){if(!t)throw new Error(e||"Assertion failed")},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},repeat:function(t,e){return new Array(t+1).join(e)},indent:function(t,e){var r=void 0===arguments[2]?" ":arguments[2];return t.replace(/^(?!\s*$)/gm,n.repeat(e,r))}};t.exports=n},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var n,r=[],o=t[Symbol.iterator]();!(n=o.next()).done&&(r.push(n.value),!e||r.length!==e););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(t,e){var n=Object.create(t.prototype),r=t.apply(n,e);return null==r||"object"!=typeof r&&"function"!=typeof r?n:r},a=function C(t,e,n){var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:C(o,e,n)}if("value"in r&&r.writable)return r.value;var i=r.get;return void 0===i?void 0:i.call(n)},s=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)},u=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},c=(r(n(6)),r(n(1))),l=(r(n(4)),n(3)),p=(l.ReadableTarget,l.WritableTarget,l.rt,l.wt,n(5)),f=p.ApplicationError,d=p.CompositionError,h=r(n(7)),v=r(n(8)),y=r(n(9)),g=r(n(10)),m=r(n(11)),w=r(n(12)),A=r(n(13)),b=r(n(14)),_=r(n(15)),D=r(n(16)),O=r(n(17));t.exports=c.newClass(function(){this._compositions=[],this._facadeMethods=[],this._onNewFacadeMethodListeners=[],h(this),v(this),y(this),g(this),m(this),w(this),A(this),b(this),_(this),D(this),O(this)},{_evaluatePrecondition:function(t,e){if(t.precondition){var n=t.precondition(e);if(n instanceof f)return n;if(!n)return new f(t,e.value)}return!0},newOperationType:function(t,e,n){var r=this;if("string"==typeof t){var l=[this.Delta,t,e],p=o(l,3);t=p[0],e=p[1],n=p[2]}n||(n={});var f=this;c.assert(e[0]===e[0].toUpperCase(),"Delta operations must have a name starting with a capital letter -- '"+e+"' does not."),c.assert(!this.Delta[e],"The '"+e+"' operation type already exists.");var d=function(t){function e(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];if(u(this,e),a(Object.getPrototypeOf(e.prototype),"constructor",this).apply(this,n),this.construct){var o;(o=this).construct.apply(o,n)}}return s(e,t),e}(t);return this.Delta[e]=d,c.extend(d.prototype,n,{applyTo:function(t){var e=void 0===arguments[1]?{}:arguments[1];if(this.selected){var r=f._evaluatePrecondition(this,t);if(r!==!0)throw r;c.isDefined(n.applyTo)&&n.applyTo.call(this,t,e)}},type:e}),(n.methods||[e[0].toLowerCase()+e.slice(1)]).forEach(function(t){r.newFacadeMethod(t,function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];return i(d,e)})}),d},newFacadeMethod:function(t,e){this._facadeMethods.push([t,e]),this._onNewFacadeMethodListeners.forEach(function(n){n(t,e)})},onNewFacadeMethod:function(t){this._onNewFacadeMethodListeners.push(t),this._facadeMethods.forEach(function(e){var n=o(e,2),r=n[0],i=n[1];t(r,i)})},newComposition:function(t,e){this._compositions.push({precondition:t,compose:e})},composed:function(t,e){c.isUndefined(t)&&(t=new this.Delta.NoOp),c.isUndefined(e)&&(e=new this.Delta.NoOp);var n=function(){},r=this._compositions.some(function(r){var o=r.precondition,i=r.compose;return o(t,e)?(n=i,!0):void 0});if(!r)throw new d(t,e);return n(t,e)}})},function(t,e,n){"use strict";function r(t,e){return new u(t,e)}function o(t,e){return new s(t,e)}var i=function(t){return t&&t.__esModule?t["default"]:t};e.wt=r,e.rt=o;var a=i(n(1)),s=e.ReadableTarget=a.newClass(function(t){this._val=t},Object.defineProperties({getValue:function(){return this._val}},{value:{get:function(){return this.getValue()},set:function(t){this.setValue(t)},enumerable:!0,configurable:!0}})),u=e.WritableTarget=a.newSubclass(s,function(){return function(t,e){this._obj=t,this._prop=e}},{getValue:function(){return this._obj[this._prop]},setValue:function(t){this._obj[this._prop]=t},"delete":function(){delete this._obj[this._prop]}});s.prototype.chain=function(t){return a.assert(this.value instanceof Object,"The ReadableTarget.prototype.chain method expects the target value to be an Object."),new u(this.value,t)},Object.defineProperty(e,"__esModule",{value:!0})},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var n,r=[],o=t[Symbol.iterator]();!(n=o.next()).done&&(r.push(n.value),!e||r.length!==e););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r(n(1)),a=i.newClass(function(){var t=void 0===arguments[0]?"":arguments[0],e=t.match(/^([.#]?)(\w*|\(\w+\))(.*)$/);i.assert(e,"The path string '"+t+"' is not well formed.");var n=o(e,4),r=n[1],s=n[2],u=n[3];"#"===r?this.set(new a(".(instance)."+s+u)):""!==s&&(this._prop=s,""!==u&&(this._rest=new a(u)))},Object.defineProperties({set:function(t){this._prop=t._prop,this._rest=t._rest},toString:function(){var t="";return i.isDefined(this.prop)&&(t+=this.prop,i.isDefined(this.rest)&&(t+="."+this.rest.toString())),t}},{prop:{get:function(){return this._prop},enumerable:!0,configurable:!0},rest:{get:function(){return this._rest},enumerable:!0,configurable:!0}}));t.exports=a},function(t,e,n){"use strict";{var r=function(t){return t&&t.__esModule?t["default"]:t},o=r(n(1)),i=e.ApplicationError=o.newSubclass(Error,function(t){return function(e,n){t.call(this),this.name="ApplicationError",this.message="This delta of type '"+e.type+"' cannot apply to this value of type '"+typeof n+"'.",this.delta=e,this.value=n}}),a=(e.MultipleOverloadsApplicationError=o.newSubclass(i,function(t){return function(e,n){var r=void 0===arguments[2]?[]:arguments[2];t.call(this,e,n),this.name="MultipleOverloadsApplicationError",this.message="None of the delta-types "+e.overloads.map(function(t){return"'"+t.type+"'"}).join(",")+" can apply to this value of type '"+typeof n+"'."+r.map(function(t){return"\n-- "+t.message}).join(""),this.errors=r}}),e.NoOverloadsApplicationError=o.newSubclass(i,function(t){return function(e,n){t.call(this,e,n),this.name="NoOverloadsApplicationError",this.message="This delta of type '"+e.type+"' has no spcific deltas assigned to it, so it cannot apply to this value of type '"+typeof n+"."}}),e.DeltaArgApplicationError=o.newSubclass(i,function(t){return function(e,n){t.call(this,e,n.arg),this.name="DeltaArgApplicationError",this.message="This delta of type '"+e.type+"' cannot apply to the type-'"+typeof n.arg+"'-value of this base delta of type '"+n.type+"'.",this.baseDelta=n}}),e.CompositionError=o.newSubclass(Error,function(t){return function(e,n){t.call(this),this.name="CompositionError",this.message="This delta of type '"+e.type+"' cannot be composed with this other delta of type '"+n.type+"'.",this.delta1=e,this.delta2=n}}));e.MultipleOverloadsCompositionError=o.newSubclass(a,function(t){return function(e,n){var r=void 0===arguments[2]?[]:arguments[2];t.call(this,e,n),this.name="MultipleOverloadsCompositionError",this.message="There are no overloads to compose this delta of type '"+e.type+"' with this other delta of type '"+n.type+"'."+r.map(function(t){return"\n-- "+t.message}).join(""),this.errors=r}}),e.ConstraintFailure=o.newSubclass(Error,function(t){return function(e){t.call(this),this.name="ConstraintFailure",this.message="The feature '"+e.name+"' is both selected and excluded by its constraints.",this.feature=e}}),e.ApplicationOrderCycle=o.newSubclass(Error,function(t){return function(e,n){t.call(this),this.name="ApplicationOrderCycle",this.message="The new application order between "+e+" and "+n+" created a cycle.",this.from=e,this.to=n}}),e.DeltaConflict=o.newSubclass(Error,function(t){return function(e){t.call(this),this.name="DeltaConflict";var n=e.map(function(t){return"'"+t.name+"'"}).join(",");this.message="There is an unresolved conflict between deltas "+n+".",this.deltas=e}}),e.MultipleActiveFacadesError=o.newSubclass(Error,function(t){return function(e){t.call(this),this.name="MultipleActiveFacadesError",this.delta=e,this.message="Only one 'do' interface can be active per '"+e.type+"' delta."}})}Object.defineProperty(e,"__esModule",{value:!0})},function(e){e.exports=t},function(t,e,n){"use strict";{var r=function(t){return t&&t.__esModule?t["default"]:t},o=r(n(1)),i=n(3),a=i.ReadableTarget,s=i.wt;r(n(17))}t.exports=function(t){o.isDefined(t.Delta)||(t._nextDeltaID=0,t.Delta=o.newClass(function(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];this.id=t._nextDeltaID++,this.arg=n[0],this.args=n},{clone:function(){return new this.constructor(this.arg)},appliedTo:function(t){var e=void 0===arguments[1]?{}:arguments[1];t instanceof a&&(t=t.value),"function"==typeof t.clone&&(t=t.clone());var n={value:t};return this.applyTo(s(n,"value"),e),n.value},composedWith:function(e){return t.composed(this,e)},toString:function(){var t=void 0===arguments[0]?{}:arguments[0],e=this.type;return t.targetProp&&(e+=" ‹"+t.targetProp+"›"),this.args.length>0&&(e+=": "+this.args.map(function(t){return JSON.stringify(t)}).join(",")),t.debug&&(e+=" ("+this.id+")"),e}}))}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},i=function(t,e){var n=Object.create(t.prototype),r=t.apply(n,e);return null==r||"object"!=typeof r&&"function"!=typeof r?n:r},a=r(n(1)),s=r(n(7)),u=n(5).MultipleActiveFacadesError;t.exports=function(t){if(!a.isDefined(t.Delta.Composite)){s(t);var e={};t.onNewFacadeMethod(function(t,n){a.a(e,t).push(n)}),a.extend(t.constructor.prototype,{_newDeltaByMethod:function(t){for(var n=arguments.length,r=Array(n>1?n-1:0),o=1;n>o;o++)r[o-1]=arguments[o];var a=e[t.method].map(function(t){return t.apply(void 0,r)});if(1===a.length)return a[0];var s=i(this.Delta.Overloaded,r);return s.overloads=a,s}}),t.Delta.Composite=a.newSubclass(t.Delta,function(t){return function(){for(var e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];t.apply(this,n)}},{operation:function(){throw new Error("A Delta.Composite subclass (in this case: "+this.type+") needs to implement the 'operation' method.")},"do":function(){for(var t=arguments.length,e=Array(t),r=0;t>r;r++)e[r]=arguments[r];var i=this,s=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];return i["do"].apply(i,o(s._args).concat(e))});return s._args=e,a.extend(s,n,{_applyOperationMethod:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),r=1;e>r;r++)n[r-1]=arguments[r];return i.operation.apply(i,[{method:t}].concat(o(s._args),n))},delta:i}),s}});var n={};t.onNewFacadeMethod(function(e){a.isUndefined(n[e])&&(n[e]=function(){for(var n,r=arguments.length,o=Array(r),i=0;r>i;i++)o[i]=arguments[i];if(this._facadeDisabled)throw new u(this);var a=(n=this)._applyOperationMethod.apply(n,[e].concat(o));if(a instanceof t.Delta.Composite){for(var s=this._activeSubFacade;s;)s._facadeDisabled=!0,s=s._activeSubFacade;return this._activeSubFacade=a["do"]()}return this})})}}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},i=r(n(1)),a=r(n(7)),s=n(5),u=s.MultipleOverloadsApplicationError,c=s.NoOverloadsApplicationError,l=s.MultipleOverloadsCompositionError;t.exports=function(t){i.isDefined(t.Delta.Overloaded)||(a(t),t.newOperationType("Overloaded",{construct:function(){this.overloads=[]},clone:function(){var e,n=(e=t.Delta.prototype.clone).call.apply(e,[this].concat(o(this.args)));return n.overloads=this.overloads.map(function(t){return t.clone()}),n},applyTo:function(e){var n=void 0===arguments[1]?{}:arguments[1],r=[],o=this.overloads.some(function(o){var i=t._evaluatePrecondition(o,e);return i!==!0?(r.push(i),!1):(o.applyTo(e,n),!0)});if(!o)throw 0===r.length?new c(this,e.value):1===r.length?r[0]:new u(this,e.value,r)},toString:function(){var e=void 0===arguments[0]?{}:arguments[0],n=t.Delta.prototype.toString.call(this,e),r=this.overloads.map(function(t){return t.toString(e)}).join("\n");return n+="\n"+i.indent(r,4)}}),t.newComposition(function(e,n){return e instanceof t.Delta.Overloaded||n instanceof t.Delta.Overloaded},function(e,n){var r=e instanceof t.Delta.Overloaded?e.overloads:[e],o=n instanceof t.Delta.Overloaded?n.overloads:[n],i=new t.Delta.Overloaded,a=[];if(r.forEach(function(t){o.forEach(function(e){try{i.overloads.push(t.composedWith(e))}catch(n){a.push(n)}})}),0===i.overloads.length)throw new l(e,n,a);return i}))}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=Array.prototype.slice,i=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},a=r(n(1)),s=r(n(4)),u=n(3).wt,c=r(n(8));t.exports=function(t){a.isDefined(t.Delta.Modify)||(c(t),t.newOperationType(t.Delta.Composite,"Modify",{construct:function(){this.deltas={}},clone:function(){var e,n=this,r=(e=t.Delta.prototype.clone).call.apply(e,[this].concat(i(this.args)));return Object.keys(this.deltas).forEach(function(t){r.deltas[t]=n.deltas[t].clone()}),r},precondition:function(t){return t.value instanceof Object},applyTo:function(t){var e=this,n=void 0===arguments[1]?{}:arguments[1];Object.keys(this.deltas).forEach(function(r){n.restrictToProperty&&n.restrictToProperty!==r||e.deltas[r].applyTo(u(t.value,r),a.extend({},n,{restrictToProperty:null}))})},toString:function(){var e=this,n=void 0===arguments[0]?{}:arguments[0],r=t.Delta.prototype.toString.call(this,n);if(Object.keys(this.deltas).length>0){var o=Object.keys(this.deltas).map(function(t){return e.deltas[t].toString(a.extend({},n,{targetProp:t}))}).join("\n");r+="\n"+a.indent(o,4)}return r},operation:function(e,n){for(var r=arguments.length,i=Array(r>2?r-2:0),u=2;r>u;u++)i[u-2]=arguments[u];for(var c=[].concat(o.call(arguments)),l={};"object"==typeof c[0];)a.extend(l,c.shift());n=c.shift();var p=t._newDeltaByMethod.apply(t,[l].concat(c));return this._addOperation(l,new s(n),p)},deepestModifyDeltaByPath:function(t){return a.isUndefined(t.prop)||"Modify"!==this.deltas[t.prop].type?{delta:this,rest:t}:this.deltas[t.prop].deepestModifyDeltaByPath(t.rest||new s)},_addOperation:function(e,n,r){return n.rest?this.operation({method:"modify"},n.prop)._addOperation(e,n.rest,r):(this.deltas[n.prop]=this.deltas[n.prop]?this.deltas[n.prop].composedWith(r):r,this.deltas[n.prop]instanceof t.Delta.Composite?this.deltas[n.prop]:r)}}))}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var n,r=[],o=t[Symbol.iterator]();!(n=o.next()).done&&(r.push(n.value),!e||r.length!==e););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},a=r(n(1)),s=n(3),u=s.WritableTarget,c=(s.ReadableTarget,s.rt,s.wt),l=n(5).DeltaArgApplicationError,p=r(n(7));t.exports=function(t){function e(t,e){return function(n,r){return n.type===t&&r.type===e}}function n(e,n){return"string"==typeof n&&(n=function(t){return function(e){return e[t]}}(n)),function(r,o){return new t.Delta[e](n&&n({d1:r,d2:o,p1:r.arg,p2:o.arg}))}}if(!a.isDefined(t._basicOperationsDefined)){t._basicOperationsDefined=!0,p(t);var r=t.newOperationType("NoOp");t.newComposition(function(t){return t instanceof r},function(t,e){return e.clone()}),t.newComposition(function(t,e){return e instanceof r},function(t){return t.clone()}),[["Add","add",function(t){return a.isUndefined(t.value)}],["Replace","replace",function(t){return a.isDefined(t.value)}]].forEach(function(e){var n=o(e,3),r=n[0],s=(n[1],n[2]);t.newOperationType(r,{construct:function(){this.deltasToApplyToArg=[]},precondition:function(t){return t instanceof u&&s(t)},applyTo:function(t){t.value=this.deltasToApplyToArg.reduce(function(t,e){return e.appliedTo(t)},this.arg)},clone:function(){var e,n=(e=t.Delta.prototype.clone).call.apply(e,[this].concat(i(this.args)));return n.deltasToApplyToArg=this.deltasToApplyToArg.map(function(t){return t}),n},afterApplying:function(e){var n=this.clone();if(n.deltasToApplyToArg.push(e),n.deltasToApplyToArg.reduce(function(e,n){return t.composed(e,n)}).precondition(c(n,"arg"))!==!0)throw new l(e,this);return n},toString:function(){var e=this,n=void 0===arguments[0]?{}:arguments[0],r=t.Delta.prototype.toString.call(this,n);if(Object.keys(this.deltasToApplyToArg).length>0){var o=Object.keys(this.deltasToApplyToArg).map(function(t){return e.deltasToApplyToArg[t].toString(n)}).join("\n");r+="\n"+a.indent(o,4)}return r}})}),t.newOperationType("Remove",{precondition:function(t){return t instanceof u&&a.isDefined(t.value)},applyTo:function(t){t["delete"]()}}),t.newOperationType("Forbid",{precondition:function(t){return a.isUndefined(t.value)}}),t.newComposition(e("Modify","Modify"),function(e,n){var r=e.clone();return Object.keys(n.deltas).forEach(function(e){r.deltas[e]=t.composed(r.deltas[e],n.deltas[e])}),r}),t.newComposition(e("Add","Modify"),function(t,e){return t.afterApplying(e)}),t.newComposition(e("Modify","Remove"),n("Remove")),t.newComposition(e("Add","Remove"),n("Forbid")),t.newComposition(e("Remove","Add"),n("Replace",function(t){var e=t.p2;return e})),t.newComposition(e("Remove","Forbid"),n("Remove")),t.newComposition(e("Forbid","Add"),n("Add",function(t){var e=t.p2;return e})),t.newComposition(e("Forbid","Forbid"),n("Forbid")),t.newComposition(e("Modify","Replace"),n("Replace",function(t){var e=t.p2;return e})),t.newComposition(e("Add","Replace"),n("Add",function(t){var e=t.p2;return e})),t.newComposition(e("Replace","Modify"),function(t,e){return t.afterApplying(e)}),t.newComposition(e("Replace","Remove"),n("Remove")),t.newComposition(e("Replace","Replace"),n("Replace",function(t){var e=t.p2;return e}))}}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},i=r(n(1)),a=n(3),s=(a.WritableTarget,a.ReadableTarget,a.rt,a.wt,n(5).DeltaArgApplicationError,r(n(11)));t.exports=function(t){function e(t,e){return function(n,r){return n.type===t&&r.type===e}}function n(e,n){return"string"==typeof n&&(n=function(t){return function(e){return e[t]}}(n)),function(r,o){return new t.Delta[e](n&&n({d1:r,d2:o,p1:r.arg,p2:o.arg}))}}if(!i.isDefined(t.Delta.PutIntoArray)){s(t);var r=t.newOperationType("PutIntoArray",{construct:function(){this.values=this.arg?Array.isArray(this.arg)?this.arg:[this.arg]:[]},clone:function(){var e,n=(e=t.Delta.prototype.clone).call.apply(e,[this].concat(o(this.args)));return n.values=[],this.values.forEach(function(t){n.values.push(t)}),n},precondition:function(t){return i.isDefined(t.value)&&Array.isArray(t.value)},applyTo:function(t){var e=t.value;this.values.forEach(function(t){var n=t.method,r=t.value;switch(n){case"prepend":e.unshift(r);break;case"insert":var o=Math.floor(Math.random()*(e.length+1));e.splice(o,0,r);break;case"append":e.push(r)}})},methods:[]});t.newFacadeMethod("prepend",function(t){return new r({method:"prepend",value:t},{})}),t.newFacadeMethod("insert",function(t){return new r({method:"insert",value:t},{})}),t.newFacadeMethod("append",function(t){return new r({method:"append",value:t},{})}),t.newComposition(e("Add","PutIntoArray"),function(t,e){return t.afterApplying(e)}),t.newComposition(e("Replace","PutIntoArray"),function(t,e){return t.afterApplying(e)}),t.newComposition(e("PutIntoArray","Remove"),n("Remove")),t.newComposition(e("PutIntoArray","Replace"),n("Replace",function(t){var e=t.p2;return e})),t.newComposition(e("PutIntoArray","PutIntoArray"),function(e,n){return new t.Delta.PutIntoArray(e.values.concat(n.values))})}}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},i=r(n(1)),a=n(3).WritableTarget,s=r(n(11));t.exports=function(t){function e(t,e){return function(n,r){return n.type===t&&r.type===e}}function n(e,n){return"string"==typeof n&&(n=function(t){return function(e){return e[t]}}(n)),function(r,o){return new t.Delta[e](n&&n({d1:r,d2:o,p1:r.arg,p2:o.arg}))}}if(!i.isDefined(t.Delta.PutIntoFunction)){s(t);var r=t.newOperationType("PutIntoFunction",{construct:function(){this.values=this.arg?Array.isArray(this.arg)?this.arg:[this.arg]:[]},clone:function(){var e,n=(e=t.Delta.prototype.clone).call.apply(e,[this].concat(o(this.args)));return n.values=[],this.values.forEach(function(t){n.values.push(t)}),n},precondition:function(t){return i.isDefined(t.value)&&"function"==typeof t.value&&(i.isDefined(t.value._DeltaJs_functions)||t instanceof a)},applyTo:function(t){if(i.isUndefined(t.value._DeltaJs_functions)){var e=t.value,n=function(t){var e=function(){return t.apply(this,arguments)};return e.toString=function(){return t.toString()},e}(function(){for(var t=this,e=arguments.length,r=Array(e),o=0;e>o;o++)r[o]=arguments[o];var i;return n._DeltaJs_functions.forEach(function(e){i=e.apply(t,r)}),i});n._DeltaJs_functions=[function(){for(var t=arguments.length,n=Array(t),r=0;t>r;r++)n[r]=arguments[r];e.apply(this,n)}],t.value=n}var r=t.value._DeltaJs_functions;this.values.forEach(function(t){var e=t.method,n=t.value;switch(e){case"prepend":r.unshift(n);break;case"insert":var o=Math.floor(Math.random()*(r.length+1));r.splice(o,0,n);break;case"append":r.push(n)}})},methods:[]});t.newFacadeMethod("prepend",function(t){return new r({method:"prepend",value:t},{})}),t.newFacadeMethod("insert",function(t){return new r({method:"insert",value:t},{})}),t.newFacadeMethod("append",function(t){return new r({method:"append",value:t},{})}),t.newComposition(e("Add","PutIntoFunction"),function(t,e){return t.afterApplying(e)}),t.newComposition(e("Replace","PutIntoFunction"),function(t,e){return t.afterApplying(e)}),t.newComposition(e("PutIntoFunction","Remove"),n("Remove")),t.newComposition(e("PutIntoFunction","Replace"),n("Replace",function(t){var e=t.p2;return e})),t.newComposition(e("PutIntoFunction","PutIntoFunction"),function(e,n){return new t.Delta.PutIntoFunction(e.values.concat(n.values))})}}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=Array.prototype.slice,i=r(n(6)),a=n(5).ApplicationOrderCycle,s=r(n(1)),u=r(n(4)),c=r(n(8));t.exports=function(t){if(!s.isDefined(t.Delta.DeltaModel)){c(t);var e=t.newOperationType(t.Delta.Composite,"DeltaModel",{construct:function(){this.graph=new i},clone:function(){var t=new e;return t.graph=this.graph.clone(),t.graph.eachVertex(function(e,n){t.graph.setVertex(e,n.clone())}),t},applyTo:function(t){var e=void 0===arguments[1]?{}:arguments[1];this.graph.topologically(function(n,r){r.applyTo(t,e)})},operation:function(e,n,r,i){for(var a=arguments.length,c=Array(a>4?a-4:0),l=4;a>l;l++)c[l-4]=arguments[l];for(var p=[].concat(o.call(arguments)),f={};"object"==typeof p[0];)s.extend(f,p.shift());for(n=p.shift();"object"==typeof p[0];)s.extend(f,p.shift());i=p.shift();var d=t._newDeltaByMethod.apply(t,[f].concat(p));return this._addOperation(n,f,new u(i),d)},toString:function(){var e=void 0===arguments[0]?{}:arguments[0],n=t.Delta.prototype.toString.call(this,e);if(this.graph.vertexCount()>0){var r="";this.graph.topologically(function(t,n){r+="["+t+"] "+n.toString(e)+"\n"}),n+="\n"+s.indent(r,4)}return n},_addOperation:function(e,n,r,o){var i,u=this,c=this.graph.vertexValue(e);if(s.isDefined(c)&&"Modify"===c.type&&s.isDefined(r.rest))return c._addOperation(n,r.rest,o);if(r.prop&&(i=new t.Delta.Modify,i._addOperation(n,r,o)),s.isDefined(c))i=c.composedWith(i),i.name=c.name,i.applicationCondition=c.applicationCondition,this.graph.setVertex(e,i);else{i.name=e,this.graph.addVertex(e,i),(n.resolves||[]).concat(n.after||[]).concat(n.requires||[]).forEach(function(t){if(u.graph.createEdge(t,e),u.graph.hasCycle())throw u.graph.removeExistingEdge(t,e),new a(t,e)});var l;l=n.feature?t.newFeature(e,n):t.newFeature("delta__"+e,s.extend({hidden:!0},n)),(n.feature||l.conditional)&&(i.applicationCondition=l),s.isDefined(n.resolves)&&l["if"](n.resolves),s.isDefined(n.requires)&&l.selects(n.requires)}return o}});t.newComposition(function(t,n){return t instanceof e||n instanceof e},function(t,n){var r=new e;return r.graph.addNewVertex(1,t),r.graph.addNewVertex(2,n),r.graph.addNewEdge(1,2),r})}}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){for(var n,r=[],o=t[Symbol.iterator]();!(n=o.next()).done&&(r.push(n.value),!e||r.length!==e););return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=r(n(1)),a=n(5).ConstraintFailure;t.exports=function(t){function e(e){return e=Array.isArray(e)?e:[e],e=e.map(function(e){return e instanceof t.Feature?e.name:e})}function n(t){var n=void 0===arguments[1]?[]:arguments[1];h=!0,n===!0?p[t]=!0:n===!1||l[t]!==!0&&i.a(l,t).push(e(n))}function r(t,r){e(r).forEach(function(e){n(e,t)})}function s(t){var n=void 0===arguments[1]?[]:arguments[1];h=!0,n===!1?d[t]=!1:n===!0||f[t]!==!1&&i.a(f,t).push(e(n))}function u(t,n){e(n).forEach(function(e){s(e,t)})}function c(){if(h){h=!1;var e;do e=!1,Object.keys(t.features).forEach(function(t){p[t]||(i.isUndefined(p[t])&&(p[t]=!1),(l[t]||[]).some(function(t){return t.every(function(t){return p[t]})})&&(p[t]=!0,e=!0))});while(e);Object.keys(t.features).forEach(function(t){d[t]=(f[t]||[]).every(function(t){return t.some(function(t){return p[t]})})})}}if(!t._featuresImplemented){t._featuresImplemented=!0;var l={},p={},f={},d={},h=!1;t.Feature=i.newClass(function(t){var e=this,n=void 0===arguments[1]?{}:arguments[1];this.name=t,this.options=n,Object.keys(n).forEach(function(t){e.addOption(t,n[t])})},Object.defineProperties({select:function(){this["if"](!0)}},{selected:{get:function(){if(c(),p[this.name]&&!d[this.name])throw new a(this);return p[this.name]},enumerable:!0,configurable:!0},condition:{get:function(){return l[this.name]},enumerable:!0,configurable:!0},conditional:{get:function(){return i.a(l,this.name).length>0},enumerable:!0,configurable:!0},restricted:{get:function(){return i.a(f,this.name).length>0},enumerable:!0,configurable:!0}}));var v=[["if",[n,u]],["onlyIf",[s]],["selects",[r,s]],["requiredBy",[u]],["iff",[n,u,s]]];t.Feature.prototype.addOption=function(t,e){var n=this;v.forEach(function(r){var i=o(r,2),a=i[0],s=i[1];t===a&&s.forEach(function(t){t(n.name,e)})})},v.forEach(function(e){var n=o(e,1),r=n[0];t.Feature.prototype[r]=function(t){this.addOption(r,t)}}),t.features={},i.isDefined(t.constructor._featuresImplemented)||(t.constructor._featuresImplemented=!0,i.extend(t.constructor.prototype,{newFeature:function(t){var e=void 0===arguments[1]?{}:arguments[1];return i.assert(i.isUndefined(this.features[t]),"A feature with the name '"+t+"' already exists."),this.features[t]=new this.Feature(t,e)}}))}}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0})},i=r(n(1)),a=n(3).rt,s=r(n(14));t.exports=function(t){s(t),t._variationPointsImplemented||(t._variationPointsImplemented=!0,t._deltaModel=new t.Delta.DeltaModel,i.isDefined(t.constructor._variationPointsImplemented)||(t.constructor._variationPointsImplemented=!0,i.extend(t.constructor.prototype,{vp:function(t,e){var n=o({},t,e);return this._deltaModel.applyTo(a(n),{restrictToProperty:t}),n[t]},operation:function(){var t;return(t=this._deltaModel).operation.apply(t,arguments)},"do":function(){for(var t,e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];return(t=this._deltaModel)["do"].apply(t,[{feature:!0}].concat(n))}})))}},function(t,e,n){"use strict";var r=function(t){return t&&t.__esModule?t["default"]:t},o=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},i=r(n(1));t.exports=function(t){t._applicationConditionsImplemented||(t._applicationConditionsImplemented=!0,i.extend(t.Delta.prototype,Object.defineProperties({},{applicationCondition:{get:function(){return this._applicationCondition},set:function(t){this._applicationCondition=t},enumerable:!0,configurable:!0},selected:{get:function(){return i.isUndefined(this.applicationCondition)||this.applicationCondition.selected},enumerable:!0,configurable:!0}})),i.isDefined(t.constructor._applicationConditionsImplemented)||(t.constructor._applicationConditionsImplemented=!0,i.extend(t.constructor.prototype,{select:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;e>r;r++)n[r]=arguments[r];
n.forEach(function(e){if(Array.isArray(e)){var n;(n=t).select.apply(n,o(e))}else t.features[e].select()})}})))}}])});