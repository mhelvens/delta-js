!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("js-graph")):"function"==typeof define&&define.amd?define(["js-graph"],e):"object"==typeof exports?exports.DeltaJs=e(require("js-graph")):t.DeltaJs=e(t.JsGraph)}(this,function(t){return function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e,o){var i,n;i=[o(2),o(1)],n=function(t){"use strict";var e=t.newClass(function(){var e=this;this.operations={},this.compositions={},this.operations.Delta=t.newClass(function(t,e){this.arg=t,this.meta=e||{}},{toString:function(){var e=void 0!==arguments[0]?arguments[0]:0,o=void 0!==arguments[1]?arguments[1]:"(root)",i=this,n=t.repeat(0+e,"    "),r=""+n+this.type+" '"+o+"'";return t.isDefined(this.arg)&&(r+=": "+JSON.stringify(this.arg).slice(1,-1)),this.deltas&&Object.keys(this.deltas).length>0&&(r+="\n"+Object.keys(this.deltas).map(function(t){return i.deltas[t].toString(e+1,t)}).join("\n")),r}}),this.operations.Modify=t.newSubclass(this.operations.Delta,function(t){return function(e,o){t.call(this,e,o),this.deltas={}}},{type:"Modify",applyTo:function(e,o){var i=this;t.isDefined(o)&&(e=e[o]),t.assert(e instanceof Object,"The 'Modify' operation expects the property to be an already defined Object."),Object.keys(this.deltas).forEach(function(t){i.deltas[t].applyTo(e,t)})},compose:function(o,i){var n=this.deltas[o],r=e.compositions[n.type][i.type];return t.assert(r.length>0,"No composition is defined between '"+n.type+"' and '"+i.type+"'."),r[0](this,o,i)},modify:function(t){return this._addOperation("Modify",t)},_addOperation:function(o,i,n,r){var s=i.match(/^([.#]?)(\w+|\(\w+\))(.*)$/);t.assert(s,"The path string '"+i+"' is not well formed.");var a=s,p=a[1],d=a[2],u=a[3];if("#"===p)return this._addOperation(o,".(instance)."+d+u,n,r);if(u.length>0)return this.modify(d)._addOperation(o,u,n,r);var c=new e.operations[o](n,r);if(this.deltas[d]){var f=this.deltas[d]=this.compose(d,c);return"Modify"===o&&"Modify"!==f.type?new e.operations.TargetedModify(f.arg,r):"Modify"===f.type?f:this}return this.deltas[d]=c,"Modify"===c.type?c:this}}),this.operations.TargetedModify=t.newSubclass(this.operations.Modify,function(t){return function(e,o,i){t.call(this,o,i),this.target=e}},{_addOperation:function(o,i,n,r){var s=i.match(/^([.#]?)(\w+|\(\w+\))(.*)$/);if(t.assert(s,"The path string '"+i+"' is not well formed."),"#"===s[1])return this._addOperation(o,".(instance)."+s[2]+s[3],n,r);if(s[3].length>0)return this.modify(s[2])._addOperation(o,s[3],n,r);if("Modify"===o){var a=new e.operations.TargetedModify(n,r);return a.target=this.target[s[2]],a}return new e.operations[o](n,r).applyTo(this.target,s[2]),this}}),this.compositions.Modify={Modify:[]},this._defineObjectOperationTypes(),this._defineArrayOperationTypes(),this._defineDeltaModelOperationType()},{get Delta(){return this.operations.Modify},newOperationType:function(e,o){var i=o,n=i.construct,r=i.applyTo,s=i.methods,a=this;t.assert(!this.operations[e],"The '"+e+"' operation type already exists."),s=s||[e[0].toLowerCase()+e.slice(1)],s.forEach(function(t){a.operations.Modify.prototype[t]=function(o,i){return this._addOperation(e,o,i,{method:t})}}),this.compositions[e]={},Object.keys(this.compositions).forEach(function(o){t.assert(!a.compositions[o][e]),t.assert(!a.compositions[e][o]),a.compositions[o][e]=[],a.compositions[e][o]=[]}),this.operations[e]=t.newSubclass(this.operations.Delta,function(t){return function(e,o){t.call(this,e,o),n&&n.call(this)}},t.extend({type:e,applyTo:r}))},newComposition:function(t,e,o){this.compositions[t][e].push(o)},_defineObjectOperationTypes:function(){function e(t){var e=void 0!==arguments[1]?arguments[1]:function(){return null};return"string"==typeof e&&(e=function(t){return function(e){return e[t]}}(e)),function(o,i,r){var s={d1:o.deltas&&o.deltas[i],d2:r,p1:o.deltas&&o.deltas[i]&&o.deltas[i].arg&&o.deltas[i].arg,p2:r.arg};return new n.operations[t](e(s))}}function o(e,o){t.assert(t.isDefined(e),"The operation '"+o+"' expects the property to be defined.")}function i(e,o){t.assert(t.isUndefined(e),"The operation '"+o+"' expects the property to be undefined.")}var n=this,r=function(t,e,o){throw new Error("You cannot follow '"+t[e].type+"' with '"+o.type+"'.")};this.newOperationType("Add",{applyTo:function(t,e){i(t[e],"Add"),t[e]=this.arg}}),this.newOperationType("Remove",{applyTo:function(t,e){o(t[e],"Remove"),delete t[e]}}),this.newOperationType("Forbid",{applyTo:function(t,e){i(t[e],"Forbid")}}),this.newOperationType("Replace",{applyTo:function(t,e){o(t[e],"Replace"),t[e]=this.arg}}),this.newComposition("Modify","Modify",function(t,e,o){return Object.keys(o.deltas).forEach(function(i){t.compose(e,o.deltas[i])}),t.deltas[e]}),this.newComposition("Modify","Add",r),this.newComposition("Add","Add",r),this.newComposition("Add","Modify",e("Add",function(t){var e=t,o=e.d1,i=e.d2;return i.applyTo(o,"arg"),o.arg})),this.newComposition("Modify","Remove",e("Remove")),this.newComposition("Add","Remove",e("Forbid")),this.newComposition("Remove","Modify",r),this.newComposition("Remove","Add",e("Replace","p2")),this.newComposition("Remove","Remove",r),this.newComposition("Modify","Forbid",r),this.newComposition("Add","Forbid",r),this.newComposition("Remove","Forbid",e("Remove")),this.newComposition("Forbid","Modify",r),this.newComposition("Forbid","Add",e("Add","p2")),this.newComposition("Forbid","Remove",r),this.newComposition("Forbid","Forbid",e("Forbid")),this.newComposition("Modify","Replace",e("Replace","p2")),this.newComposition("Add","Replace",e("Add","p2")),this.newComposition("Remove","Replace",r),this.newComposition("Forbid","Replace",r),this.newComposition("Replace","Modify",e("Replace",function(t){var e=t,o=e.d1,i=e.d2;return i.applyTo(o,"arg"),o.arg})),this.newComposition("Replace","Add",r),this.newComposition("Replace","Remove",e("Remove")),this.newComposition("Replace","Forbid",r),this.newComposition("Replace","Replace",e("Replace","p2"))},_defineArrayOperationTypes:function(){function e(t){var e=void 0!==arguments[1]?arguments[1]:function(){return null};return"string"==typeof e&&(e=function(t){return function(e){return e[t]}}(e)),function(o,i,r){var s={d1:o.deltas&&o.deltas[i],d2:r,p1:o.deltas&&o.deltas[i]&&o.deltas[i].arg,p2:r.arg};return new n.operations[t](e(s))}}function o(e,o){t.assert(t.isDefined(e),"The operation '"+o+"' expects the property to be defined.")}function i(e,o){t.assert(Array.isArray(e),"The operation '"+o+"' expects the property to be an array.")}var n=this,r=function(t,e,o){throw new Error("You cannot follow '"+t[e].type+"' with '"+o.type+"'.")};this.newOperationType("Put",{construct:function(){this.values=this.meta.method?[{method:this.meta.method,value:this.arg}]:[]},applyTo:function(t,e){o(t[e],"Put"),i(t[e],"Put"),this.values.forEach(function(o){var i=o,n=i.method,r=i.value;switch(n){case"prepend":t[e].unshift(r);break;case"insert":var s=Math.floor(Math.random()*(t[e].length+1));t[e].splice(s,0,r);break;case"append":t[e].push(r)}})},methods:["prepend","insert","append"]}),this.newComposition("Modify","Put",r),this.newComposition("Add","Put",e("Add",function(t){var e=t,o=e.d1,i=e.d2;return i.applyTo(o,"arg"),o.arg})),this.newComposition("Remove","Put",r),this.newComposition("Forbid","Put",r),this.newComposition("Replace","Put",e("Replace",function(t){var e=t,o=e.d1,i=e.d2;return i.applyTo(o,"arg"),o.arg})),this.newComposition("Put","Modify",r),this.newComposition("Put","Add",r),this.newComposition("Put","Remove",e("Remove")),this.newComposition("Put","Forbid",r),this.newComposition("Put","Replace",e("Replace","p2")),this.newComposition("Put","Put",function(t,e,o){var i=new n.operations.Put;return i.values=t.deltas[e].values.concat(o.values),i})},_defineDeltaModelOperationType:function(){}});return e}.apply(e,i),!(void 0!==n&&(t.exports=n))},function(e){e.exports=t},function(t,e,o){var i;i=function(){"use strict";var t={newClass:function(t){var e=void 0!==arguments[1]?arguments[1]:{},o=t;return o.prototype=e,o.prototype.constructor=o,o},newSubclass:function(e,o){var i=void 0!==arguments[2]?arguments[2]:{},n=o(e.prototype.constructor);return n.prototype=Object.create(e.prototype),t.extend(n.prototype,i),n.prototype.constructor=n,n},extend:function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];return e.forEach(function(e){for(var o in e)e.hasOwnProperty(o)&&Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(e,o))}),t},applyConstructor:function(t,e){var o=Object.create(t.prototype);return t.apply(o,e),o},assert:function(t,e){if(!t)throw new Error(e||"Assertion failed")},isUndefined:function(t){return"undefined"==typeof t},isDefined:function(t){return"undefined"!=typeof t},repeat:function(t,e){return new Array(t+1).join(e)}};return t}.call(e,o,e,t),!(void 0!==i&&(t.exports=i))}])});