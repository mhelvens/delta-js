!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("js-graph")):"function"==typeof define&&define.amd?define(["js-graph"],t):"object"==typeof exports?exports.DeltaJs=t(require("js-graph")):e.DeltaJs=t(e.JsGraph)}(this,function(e){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){var o,i;o=[n(1),n(2)],i=function(e,t){"use strict";function n(e,n){t.assert("function"==typeof e,"The operation '"+n+"' expects the property it acts on to be a function.")}function o(e,n){t.assert(t.isDefined(e),"The operation '"+n+"' expects the property to be defined.")}function i(e,n){t.assert(t.isUndefined(e),"The operation '"+n+"' expects the property to be undefined.")}var r=function(){},a=function(e,t,n){e[t]=n},s=function(e,t,n){n.applyTo(e[t],"value")},p=t.newClass(function(){function f(e,n){_=!0,n===!0?g[e]=!0:n===!1||v[e]!==!0&&t.array(v,e).push(n)}function c(){if(_){_=!1;var e;do e=!1,m.eachVertex(function(n){g[n]||t.isUndefined(v[n])||v[n].some(function(e){return e.every(function(e){return g[e]})})&&(g[n]=!0,e=!0)});while(e)}}var d=this,l={},h=[];t.extend(this,{_addOperationType:function(e){var n=e,o=n.name,i=n.constructor,r=n.applyTo,a=n.prototype,s=n.method,p={};l[o]={name:o,Delta:i,method:p[o]},t.extend(l[o].Delta.prototype,a,{constructor:i,type:o,applyTo:r,compose:function(e,n){var o=this;if(t.isUndefined(n))return this;var i;if(h.some(function(e){var t=e,r=t.op1Type,a=t.op2Type,s=t.composeFn;return o.type===r&&n.type===a?(i=s,!0):void 0}),!i){var r=new Error("You cannot follow a '"+this.type+"' operation "+("with a '"+n.type+"' operation on the same property."));throw r.op1=this.type,r.op2=n.type,r}i(this,e,n)}}),l.modify.Delta.prototype[o]=t.isDefined(s)?s:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._addOperation(l[o],e,t),this}},_addOperationAlias:function(e){var t=e,n=t.name,o=t.target,i=t.transform,r={};Object.defineProperty(r,n,{value:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return this._addOperation(l[o],e,i(t)),this}}),l[n]={name:n,method:r[n]},l.modify.Delta.prototype[n]=l[n].method},_addCompositionRule:function(e,t,n){h.push({op1Type:e,op2Type:t,composeFn:n})},_newDelta:function(e){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return t.applyConstructor(l[e].Delta,n)}});var y=this;this._addOperationType({name:"modify",constructor:function(e,n){var o=this;e=e||{},this.operations=n||{},Object.keys(e).forEach(function(n){var i=n.match(/^(\w+)\s+([\w\.]+)$/);if(i){var r=i[1],a=i[2];t.assert(r in l,"I don't know the '"+r+"' operation."),o[r](a,e[n])}})},applyTo:function(e,n){var o=this;t.isDefined(n)?(t.assert(t.isDefined(e[n]),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){o.operations[t].applyTo(e[n],t)})):(t.assert(t.isDefined(e),"The 'modify' operation expects the property to be already defined."),Object.keys(this.operations).forEach(function(t){o.operations[t].applyTo(e,t)}))},prototype:{selectivelyApplyTo:function(e,n){t.assert(t.isDefined(e),"The 'modify' operation expects the property to be already defined."),t.isDefined(this.operations[n])&&this.operations[n].applyTo(e,n)},_addOperation:function(e,n,o){var i=n.indexOf(".");if(-1!==i){var r=n.slice(0,i),a=n.slice(i+1),s=this._addOperation(l.modify,r);return s[e.name].apply(s,[a].concat(o))}var p=y._newDelta.apply(y,[e.name].concat(o));return this.operations.hasOwnProperty(n)&&t.isDefined(this.operations[n])?this.compose(n,p):this.operations[n]=p,this.operations[n]}},method:function(e,t){return this._addOperation(l.modify,e,[t])}}),this._addOperationType({name:"add",constructor:function(e){this.value=e},applyTo:function(e,t){i(e[t],"add"),e[t]=this.value}}),this._addOperationType({name:"replace",constructor:function(e){this.value=e},applyTo:function(e,t){o(e[t],"replace"),e[t]=this.value}}),this._addOperationType({name:"remove",constructor:function(){},applyTo:function(e,t){o(e[t],"remove"),delete e[t]}}),this._addOperationType({name:"forbid",constructor:function(){},applyTo:function(e,t){i(e[t],"forbid")}}),this._addCompositionRule("add","replace",function(e,t,n){e[t]=p._newDelta("add",n.value)}),this._addCompositionRule("add","modify",s),this._addCompositionRule("add","remove",function(e,t){e[t]=p._newDelta("forbid")}),this._addCompositionRule("replace","replace",a),this._addCompositionRule("replace","modify",s),this._addCompositionRule("replace","remove",a),this._addCompositionRule("modify","replace",a),this._addCompositionRule("modify","modify",function(e,t,n){Object.keys(n.operations).forEach(function(t){e.compose(t,n.operations[t])})}),this._addCompositionRule("modify","remove",a),this._addCompositionRule("remove","add",function(e,t,n){e[t]=p._newDelta("replace",n.value)}),this._addCompositionRule("remove","forbid",r),this._addCompositionRule("forbid","add",a),this._addCompositionRule("forbid","forbid",r),this._addOperationType({name:"alter",constructor:function(e,t){this.value=e||[],this.alias=t||"alter"},applyTo:function(e,t){n(e[t],this.alias),this.value.forEach(function(n){var o=e[t],i=n.value;e[t]="prepend"===n.type?function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.apply(this,e),o.apply(this,e)}:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];o.apply(this,e),i.apply(this,e)}})}}),this._addCompositionRule("alter","alter",function(e,t,n){[].push.apply(e[t].value,n.value)}),this._addCompositionRule("alter","replace",a),this._addCompositionRule("alter","remove",function(e,t){e[t]=p._newDelta("forbid")}),this._addCompositionRule("add","alter",function(e,t,o){n(e[t].value,o.alias),s(e,t,o)}),this._addCompositionRule("replace","alter",function(e,t,o){n(e[t].value,o.alias),s(e,t,o)}),["prepend","insert","append"].forEach(function(e){d._addOperationAlias({name:e,target:"alter",transform:function(t){return[[{type:e,value:t[0]}],e]}})}),this._addOperationType({name:"after",constructor:function(e){t.assert("function"==typeof u,"Before creating an 'after' operation, you must register a promise resolver with delta.js."),this.value=e},applyTo:function(e,t){n(e[t],"after");var o=e[t],i=this.value;e[t]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return u(o.apply(this,e)).then(function(){return i.apply(this,e)}.bind(this))}}}),this._addCompositionRule("after","replace",a),this._addCompositionRule("after","remove",a),this._addCompositionRule("add","after",function(e,t,o){n(e[t].value,"after"),s(e,t,o)}),this._addCompositionRule("replace","after",function(e,t,o){n(e[t].value,"after"),s(e,t,o)}),this._addCompositionRule("insert","after",s),this._addCompositionRule("after","insert",s);var m=new e;t.extend(this,{graph:function(){return m}});var v={},g={},_=!1;this.Delta=t.newSubclass(l.modify.Delta,function(e,n,o){e.call(this,o),t.assert(o instanceof Object,"A delta should be given as an object."),l.modify.Delta.apply(this,o),Object.defineProperties(this,{name:{get:function(){return n}},manuallySelectable:{get:function(){return t.isDefined(o.manuallySelectable)?!!o.manuallySelectable:t.isDefined(o.resolves)&&o.resolves.length>0?!1:!0}},selected:{get:function(){return c(),!!g[n]}},"if":{get:function(){return o["if"]===!0||o["if"]===!1?o["if"]:o["if"]||o.iff||o.resolves?[].concat(o["if"]||[],o.iff||[],o.resolves||[]):!1}},onlyIf:{get:function(){return o.onlyIf===!0||o.onlyIf===!1?o.onlyIf:o.onlyIf||o.iff||o.expects||o.resolves?[].concat(o.onlyIf||[],o.iff||[],o.expects||[],o.resolves||[]):!0}},after:{get:function(){return[].concat(o.after||[],o.expects||[],o.resolves||[],o.requires||[])}},selects:{get:function(){return[].concat(o.selects||[],o.requires||[])}}}),_=!0,t.isDefined(this.if)&&f(n,this.if),this.selects.forEach(function(e){f(e,[n])}),m.addVertex(n,this),this.after.forEach(function(e){m.createEdge(e,n)}),t.assert(!m.hasCycle(),"The delta "+n+" introduced a cycle in the application order.")}),t.extend(this,{select:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.forEach(function(e){f(e,!0)})},vp:function(e,n){var o={};return o[e]=n,c(),m.eachVertex(function(e,n){t.assert(!n.selected||n.onlyIf===!0||n.onlyIf.every(function(e){return m.vertexValue(e).selected}),"The 'onlyIf' condition of delta '"+n.name+"' was violated.")}),m.topologically(function(t,n){n.selected&&n.selectivelyApplyTo(o,e)}),o[e]}})}),u=null;return t.extend(p,{registerPromiseResolver:function(e){u=e}}),p}.apply(t,o),!(void 0!==i&&(e.exports=i))},function(t){t.exports=e},function(e,t,n){var o;o=function(){"use strict";var e={newClass:function(e,t){t=t||{};var n=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.apply(this,t)};return n.prototype=t,n.prototype.constructor=n,n},newSubclass:function(e,t,n){n=n||{};var o=function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];t.apply(this,[e.prototype.constructor].concat(n))};return o.prototype=Object.create(e.prototype,n),o.prototype.constructor=o,o},extend:function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.forEach(function(t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}),e},array:function(t,n){return e.isUndefined(t[n])&&(t[n]=[]),t[n]},bindA:function(e,t,n){return e.bind.apply(e,[t].concat(n))},bind:function(t,n){for(var o=[],i=2;i<arguments.length;i++)o[i-2]=arguments[i];return e.bindA(t[n],t,o)},applyConstructor:function(e,t){var n=e.bind.apply(e,[null].concat(t));return new n},assert:function(e,t){if(!e)throw new Error(t||"Assertion failed")},isUndefined:function(e){return"undefined"==typeof e},isDefined:function(e){return"undefined"!=typeof e}};return e}.call(t,n,t,e),!(void 0!==o&&(e.exports=o))}])});